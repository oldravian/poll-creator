import{_ as Z,a as ye}from"./AlertError.vue_vue_type_script_setup_true_lang-CSRhsPvf.js";import{d as q,g as M,o as u,u as e,m as W,w as n,r as R,i as B,a as s,b as t,c as w,n as L,j as ue,k as D,p as J,q as T,f as k,s as fe,v as ve,t as m,F as G,x as te,y as we,z as ne,A as be,h as ke}from"./app-NQkzR2QC.js";import{c as I,a as K,_ as P,r as $e,P as Ce,b as Pe}from"./index-wNC58uex.js";import{u as me,a as De}from"./VisuallyHidden-J6ptkk6r.js";import{D as Se,a as Me,b as Te,c as Ue,d as Oe,X as ce,e as Ve,C as ge,U as re,f as X,g as ie,_ as je}from"./AppLayout.vue_vue_type_script_setup_true_lang-DrhMHYvv.js";import{_ as H,a as ee}from"./Label.vue_vue_type_script_setup_true_lang-BFdAB7sT.js";import{d as qe}from"./index-BFXA6JFU.js";import"./AppLogoIcon.vue_vue_type_script_setup_true_lang-B9cPLGNj.js";/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=I("CopyIcon",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=I("ExternalLinkIcon",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=I("EyeIcon",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=I("GripVerticalIcon",[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=I("PlusIcon",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=I("SquarePenIcon",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-vue-next v0.468.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ze=I("Trash2Icon",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]),se=q({__name:"Dialog",props:{open:{type:Boolean},defaultOpen:{type:Boolean},modal:{type:Boolean}},emits:["update:open"],setup($,{emit:_}){const g=me($,_);return(x,i)=>(u(),M(e(Se),W({"data-slot":"dialog"},e(g)),{default:n(()=>[R(x.$slots,"default")]),_:3},16))}}),Le=q({__name:"DialogOverlay",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},setup($){const _=$,c=B(()=>{const{class:v,...g}=_;return g});return(v,g)=>(u(),M(e(Me),W({"data-slot":"dialog-overlay"},c.value,{class:e(K)("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/80",_.class)}),{default:n(()=>[R(v.$slots,"default")]),_:3},16,["class"]))}}),oe=q({__name:"DialogContent",props:{forceMount:{type:Boolean},disableOutsidePointerEvents:{type:Boolean},asChild:{type:Boolean},as:{},class:{}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","openAutoFocus","closeAutoFocus"],setup($,{emit:_}){const c=$,v=_,g=B(()=>{const{class:i,...b}=c;return b}),x=me(g,v);return(i,b)=>(u(),M(e(Te),null,{default:n(()=>[s(Le),s(e(Ue),W({"data-slot":"dialog-content"},e(x),{class:e(K)("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",c.class)}),{default:n(()=>[R(i.$slots,"default"),s(e(Oe),{class:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4"},{default:n(()=>[s(e(ce)),b[0]||(b[0]=t("span",{class:"sr-only"},"Close",-1))]),_:1,__:[0]})]),_:3},16,["class"])]),_:3}))}}),le=q({__name:"DialogHeader",props:{class:{}},setup($){const _=$;return(c,v)=>(u(),w("div",{"data-slot":"dialog-header",class:L(e(K)("flex flex-col gap-2 text-center sm:text-left",_.class))},[R(c.$slots,"default")],2))}}),ae=q({__name:"DialogTitle",props:{asChild:{type:Boolean},as:{},class:{}},setup($){const _=$,c=B(()=>{const{class:g,...x}=_;return x}),v=De(c);return(g,x)=>(u(),M(e(Ve),W({"data-slot":"dialog-title"},e(v),{class:e(K)("text-lg leading-none font-semibold",_.class)}),{default:n(()=>[R(g.$slots,"default")]),_:3},16,["class"]))}}),Be={class:"flex-1 space-y-6 overflow-y-auto pr-2"},Ie={class:"space-y-2"},Ne={key:0,class:"text-sm text-red-600"},Fe={class:"text-xs text-muted-foreground"},He={class:"space-y-3"},Re={class:"flex items-center justify-between"},Ye={class:"space-y-2"},Je={class:"cursor-move text-muted-foreground"},Ge={class:"flex h-8 w-8 flex-shrink-0 items-center justify-center rounded-full bg-muted text-xs font-medium"},Qe={key:0,class:"text-sm text-red-600"},We={class:"text-xs text-muted-foreground"},Ke={class:"space-y-2"},Xe={class:"flex items-center justify-end gap-3 border-t pt-4"},Ze={key:1,class:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"},et=q({__name:"CreatePollModal",props:{open:{type:Boolean}},emits:["update:open","success"],setup($,{emit:_}){const c=$,v=_,g=ue(),x=D(""),i=D([{id:"1",text:""},{id:"2",text:""}]),b=D(""),h=D({}),a=D(!1),o=D(""),d=D([]),O=B(()=>x.value.trim().length>0&&i.value.filter(r=>r.text.trim().length>0).length>=2),V=B(()=>i.value.filter(r=>r.text.trim().length>0)),A=()=>{const r=(i.value.length+1).toString();i.value.push({id:r,text:""})},z=r=>{i.value.length>2&&(i.value=i.value.filter(l=>l.id!==r))},E=()=>{v("update:open",!1),j()},j=()=>{x.value="",i.value=[{id:"1",text:""},{id:"2",text:""}],b.value="",h.value={},a.value=!1,o.value="",d.value=[]},S=()=>(h.value={},x.value.trim()||(h.value.question="Poll question is required"),V.value.length<2&&(h.value.options="At least 2 options are required"),Object.keys(h.value).length===0),N=async()=>{if(!S()||a.value)return;a.value=!0,o.value="",d.value=[];const r={question:x.value.trim(),options:V.value.map(l=>l.text.trim()),expiresAt:b.value||void 0};try{const l=await fetch("/api/polls",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(r)}),p=await l.json();if(l.ok&&p.success)v("update:open",!1),j(),v("success");else if(a.value=!1,l.status===422&&p.errors){const U=[];for(const C in p.errors)Array.isArray(p.errors[C])&&U.push(...p.errors[C]);d.value=U,o.value=""}else o.value=p.message||"Failed to create poll. Please try again.",d.value=[]}catch(l){a.value=!1,o.value="Network error. Please check your connection and try again.",d.value=[],console.error("Network error:",l)}};J(()=>g.props.errors,r=>{r&&Object.keys(r).length>0&&(h.value={...r},a.value=!1)},{deep:!0}),J(()=>c.open,r=>{r||(a.value=!1)});const Y=()=>{E()};return(r,l)=>(u(),M(e(se),{open:r.open,"onUpdate:open":l[2]||(l[2]=p=>v("update:open",p))},{default:n(()=>[s(e(oe),{class:"flex max-h-[90vh] max-w-3xl flex-col overflow-hidden"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ae),{class:"text-xl font-semibold"},{default:n(()=>l[3]||(l[3]=[k("Create New Poll",-1)])),_:1,__:[3]})]),_:1}),d.value.length>0?(u(),M(Z,{key:0,errors:d.value,title:"Validation Errors",class:"mx-1"},null,8,["errors"])):o.value?(u(),M(Z,{key:1,errors:[o.value],title:"Error",class:"mx-1"},null,8,["errors"])):T("",!0),t("div",Be,[t("div",Ie,[s(e(H),{for:"question",class:"text-sm font-medium"},{default:n(()=>l[4]||(l[4]=[k(" Poll Question * ",-1)])),_:1,__:[4]}),fe(t("textarea",{id:"question","onUpdate:modelValue":l[0]||(l[0]=p=>x.value=p),placeholder:"What would you like to ask?",class:L(["flex min-h-[80px] w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",{"border-red-500 focus:border-red-500 focus:ring-red-500/20":h.value.question}])},null,2),[[ve,x.value]]),h.value.question?(u(),w("p",Ne,m(h.value.question),1)):T("",!0),t("p",Fe,m(x.value.length)+"/200 characters ",1)]),t("div",He,[t("div",Re,[s(e(H),{class:"text-sm font-medium"},{default:n(()=>l[5]||(l[5]=[k(" Poll Options * ",-1)])),_:1,__:[5]}),s(e(P),{type:"button",variant:"outline",size:"sm",onClick:A,class:"cursor-pointer gap-1 text-xs"},{default:n(()=>[s(e(Q),{class:"h-3 w-3"}),l[6]||(l[6]=k(" Add Option ",-1))]),_:1,__:[6]})]),t("div",Ye,[(u(!0),w(G,null,te(i.value,(p,U)=>(u(),w("div",{key:p.id,class:"group flex items-center gap-2"},[t("div",Je,[s(e(he),{class:"h-4 w-4"})]),t("div",Ge,m(U+1),1),s(e(ee),{modelValue:p.text,"onUpdate:modelValue":C=>p.text=C,placeholder:`Option ${U+1}`,class:"flex-1"},null,8,["modelValue","onUpdate:modelValue","placeholder"]),i.value.length>2?(u(),M(e(P),{key:0,type:"button",variant:"ghost",size:"sm",onClick:C=>z(p.id),class:"h-8 w-8 cursor-pointer p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Remove option"},{default:n(()=>[s(e(ce),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"])):T("",!0)]))),128))]),h.value.options?(u(),w("p",Qe,m(h.value.options),1)):T("",!0),t("p",We,m(V.value.length)+" valid options (minimum 2 required) ",1)]),t("div",Ke,[s(e(H),{for:"expires-at",class:"text-sm font-medium"},{default:n(()=>l[7]||(l[7]=[k(" Expiry Date (Optional) ",-1)])),_:1,__:[7]}),s(e(ee),{id:"expires-at",modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=p=>b.value=p),type:"datetime-local",min:new Date().toISOString().slice(0,16),class:"w-full"},null,8,["modelValue","min"]),l[8]||(l[8]=t("p",{class:"text-xs text-muted-foreground"}," Leave empty for polls that never expire ",-1))])]),t("div",Xe,[s(e(P),{type:"button",variant:"outline",onClick:Y,class:"cursor-pointer"},{default:n(()=>l[9]||(l[9]=[k(" Cancel ",-1)])),_:1,__:[9]}),s(e(P),{type:"button",onClick:N,disabled:!O.value||a.value,class:L(["cursor-pointer gap-2",{"cursor-not-allowed":!O.value||a.value}])},{default:n(()=>[a.value?(u(),w("div",Ze)):(u(),M(e(Q),{key:0,class:"h-4 w-4"})),k(" "+m(a.value?"Creating...":"Create Poll"),1)]),_:1},8,["disabled","class"])])]),_:1})]),_:1},8,["open"]))}}),pe=q({__name:"Badge",props:{asChild:{type:Boolean},as:{},variant:{},class:{}},setup($){const _=$,c=$e(_,"class");return(v,g)=>(u(),M(e(Ce),W({"data-slot":"badge",class:e(K)(e(tt)({variant:v.variant}),_.class)},e(c)),{default:n(()=>[R(v.$slots,"default")]),_:3},16,["class"]))}}),tt=Pe("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function _e(){return{formatDate:v=>{const g=new Date(v),x=new Date,i=Math.floor((x.getTime()-g.getTime())/(1e3*60*60*24));if(i===0){const b=Math.floor((x.getTime()-g.getTime())/36e5);return b===0?"Just now":`${b} hour${b===1?"":"s"} ago`}else return i===1?"Yesterday":i<7?`${i} days ago`:g.toLocaleDateString()},formatExpiryDate:v=>{if(!v)return"Never expires";const g=new Date(v),x=new Date,i=Math.ceil((g.getTime()-x.getTime())/(1e3*60*60*24));return i<0?"Expired":i===0?"Expires today":i===1?"Expires tomorrow":i<7?`Expires in ${i} days`:`Expires ${g.toLocaleDateString()}`},formatDateSimple:v=>{const g=new Date(v),i=Math.floor((new Date().getTime()-g.getTime())/(1e3*60*60*24));return i===0?"Today":i===1?"Yesterday":i<7?`${i} days ago`:g.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}}}const st={key:0,class:"flex-1 space-y-6 overflow-y-auto"},ot={class:"mb-3 text-lg font-bold text-gray-900"},lt={class:"flex flex-wrap items-center gap-4 text-sm text-gray-600"},at={class:"flex items-center gap-2"},nt={class:"flex items-center gap-2"},rt={class:"flex items-center gap-2"},it={class:"flex items-center gap-2"},dt={key:0},ut={class:"flex items-center gap-2 rounded-lg bg-gray-50 p-3"},ct={class:"flex-1 font-mono text-sm text-gray-700"},pt={class:"space-y-3"},ft={class:"mb-2 flex items-center justify-between"},vt={class:"font-medium text-gray-900"},mt={class:"flex items-center gap-2 text-sm text-gray-600"},gt={class:"h-2 w-full rounded-full bg-gray-200"},xt={key:0,class:"py-4 text-center"},ht={class:"mt-6 flex items-center justify-between border-t pt-4"},_t={class:"flex gap-2"},yt=q({__name:"PollDetailsModal",props:{open:{type:Boolean},poll:{default:null}},emits:["update:open"],setup($,{emit:_}){const c=$,v=_,{formatDateSimple:g,formatExpiryDate:x}=_e(),i=async()=>{if(!c.poll)return;const o=`${typeof window<"u"&&window.location?window.location.origin:""}/poll/${c.poll.slug}`;try{await navigator.clipboard.writeText(o),console.log("Link copied to clipboard!")}catch(d){console.error("Failed to copy link:",d)}},b=()=>{if(!c.poll)return;const a=`/poll/${c.poll.slug}`;try{const o=document.createElement("a");o.href=a,o.target="_blank",o.rel="noopener noreferrer",document.body.appendChild(o),o.click(),document.body.removeChild(o)}catch(o){console.error("Failed to open poll in new tab:",o),typeof window<"u"&&window.open&&window.open(a,"_blank","noopener,noreferrer")}},h=(a,o)=>o===0?0:Math.round(a/o*100);return(a,o)=>(u(),M(e(se),{open:a.open,"onUpdate:open":o[1]||(o[1]=d=>v("update:open",d))},{default:n(()=>[s(e(oe),{class:"flex max-h-[90vh] max-w-2xl flex-col overflow-hidden"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ae),{class:"pr-8 text-xl font-semibold"},{default:n(()=>o[2]||(o[2]=[k(" Poll Details ",-1)])),_:1,__:[2]})]),_:1}),a.poll?(u(),w("div",st,[t("div",null,[t("h2",ot,m(a.poll.question),1),t("div",lt,[t("div",at,[s(e(ge),{class:"h-4 w-4"}),t("span",null,m(e(g)(a.poll.created_at)),1)]),t("div",nt,[s(e(re),{class:"h-4 w-4"}),t("span",null,m(a.poll.total_votes)+" votes",1)]),t("div",rt,[s(e(X),{class:"h-4 w-4"}),t("span",null,m(a.poll.options_count)+" options",1)]),t("div",it,[s(e(ie),{class:"h-4 w-4"}),s(e(pe),{variant:a.poll.is_expired?"destructive":"default",class:"text-xs"},{default:n(()=>[k(m(e(x)(a.poll.expires_at)),1)]),_:1},8,["variant"])])])]),typeof a.window<"u"&&a.window.location?(u(),w("div",dt,[o[3]||(o[3]=t("h3",{class:"mb-2 text-sm font-medium text-gray-900"}," Poll Link ",-1)),t("div",ut,[t("code",ct,m(a.window.location.origin)+"/poll/"+m(a.poll.slug),1),s(e(P),{variant:"ghost",size:"sm",onClick:i,class:"h-8 w-8 cursor-pointer p-0",title:"Copy link"},{default:n(()=>[s(e(de),{class:"h-3.5 w-3.5"})]),_:1})])])):T("",!0),t("div",null,[o[5]||(o[5]=t("h3",{class:"mb-3 text-sm font-medium text-gray-900"}," Poll Options & Results ",-1)),t("div",pt,[(u(!0),w(G,null,te(a.poll.options,(d,O)=>(u(),w("div",{key:d.id,class:"rounded-lg border bg-white p-4"},[t("div",ft,[t("span",vt,m(O+1)+". "+m(d.option_text),1),t("div",mt,[t("span",null,m(d.vote_count)+" votes",1),s(e(pe),{variant:"secondary",class:"text-xs"},{default:n(()=>[k(m(h(d.vote_count,a.poll.total_votes))+"% ",1)]),_:2},1024)])]),t("div",gt,[t("div",{class:"h-2 rounded-full bg-blue-600 transition-all duration-300",style:we({width:`${h(d.vote_count,a.poll.total_votes)}%`})},null,4)])]))),128)),a.poll.total_votes===0?(u(),w("div",xt,o[4]||(o[4]=[t("p",{class:"text-sm text-gray-500"}," No votes yet. Be the first to vote! ",-1)]))):T("",!0)])])])):T("",!0),t("div",ht,[s(e(P),{variant:"outline",onClick:o[0]||(o[0]=d=>v("update:open",!1)),class:"cursor-pointer"},{default:n(()=>o[6]||(o[6]=[k(" Close ",-1)])),_:1,__:[6]}),t("div",_t,[typeof a.window<"u"&&a.window.location?(u(),M(e(P),{key:0,variant:"outline",onClick:i,class:"cursor-pointer gap-2"},{default:n(()=>[s(e(de),{class:"h-4 w-4"}),o[7]||(o[7]=k(" Copy Link ",-1))]),_:1,__:[7]})):T("",!0),s(e(P),{onClick:b,class:"cursor-pointer gap-2"},{default:n(()=>[s(e(xe),{class:"h-4 w-4"}),o[8]||(o[8]=k(" Open Poll ",-1))]),_:1,__:[8]})])])]),_:1})]),_:1},8,["open"]))}}),wt={class:"flex-1 space-y-6 overflow-y-auto pr-2"},bt={class:"space-y-2"},kt={key:0,class:"text-xs text-red-600"},$t={class:"space-y-3"},Ct={class:"space-y-2"},Pt={class:"cursor-move text-muted-foreground"},Dt={class:"flex-1"},St={key:1,class:"h-8 w-8"},Mt={key:0,class:"text-xs text-red-600"},Tt={class:"space-y-2"},Ut={class:"relative"},Ot={key:0,class:"text-xs text-red-600"},Vt={class:"flex justify-end gap-3 border-t pt-4"},jt={key:0,class:"h-4 w-4 animate-spin rounded-full border-2 border-current border-t-transparent"},qt=q({__name:"UpdatePollModal",props:{open:{type:Boolean},poll:{default:null}},emits:["update:open","success"],setup($,{emit:_}){const c=$,v=_,g=ue(),x=D(""),i=D([{id:"1",text:""},{id:"2",text:""}]),b=D(""),h=D({}),a=D(!1),o=D(""),d=D([]),O=B(()=>x.value.trim().length>0&&V.value.length>=2&&V.value.every(r=>r.text.trim().length>0)),V=B(()=>i.value.filter(r=>r.text.trim().length>0)),A=()=>{const r=(i.value.length+1).toString();i.value.push({id:r,text:""})},z=r=>{i.value.length>2&&(i.value=i.value.filter(l=>l.id!==r))},E=()=>{v("update:open",!1),j()},j=()=>{x.value="",i.value=[{id:"1",text:""},{id:"2",text:""}],b.value="",h.value={},a.value=!1,o.value="",d.value=[]},S=()=>{if(c.poll)if(x.value=c.poll.question,c.poll.options&&c.poll.options.length>0&&(i.value=c.poll.options.map((r,l)=>({id:(l+1).toString(),text:r.option_text}))),c.poll.expires_at){const r=new Date(c.poll.expires_at),l=r.getFullYear(),p=String(r.getMonth()+1).padStart(2,"0"),U=String(r.getDate()).padStart(2,"0"),C=String(r.getHours()).padStart(2,"0"),f=String(r.getMinutes()).padStart(2,"0");b.value=`${l}-${p}-${U}T${C}:${f}`}else b.value=""},N=()=>(h.value={},x.value.trim()||(h.value.question="Poll question is required"),V.value.length<2&&(h.value.options="At least 2 options are required"),Object.keys(h.value).length===0),Y=async()=>{if(!N()||a.value||!c.poll)return;a.value=!0,o.value="",d.value=[];const r={question:x.value.trim(),options:V.value.map(l=>l.text.trim()),expiresAt:b.value||void 0};try{const l=await fetch(`/api/polls/${c.poll.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(r)}),p=await l.json();if(l.ok&&p.success)v("update:open",!1),j(),v("success");else if(a.value=!1,l.status===422&&p.errors){const U=[];for(const C in p.errors)Array.isArray(p.errors[C])&&U.push(...p.errors[C]);d.value=U,o.value=""}else o.value=p.message||"Failed to update poll. Please try again.",d.value=[]}catch(l){a.value=!1,o.value="Network error. Please check your connection and try again.",d.value=[],console.error("Network error:",l)}};return J(()=>g.props.errors,r=>{r&&Object.keys(r).length>0&&(h.value={...r})},{immediate:!0}),J(()=>c.poll,r=>{r&&c.open&&S()},{immediate:!0}),J(()=>c.open,r=>{r&&c.poll?S():r||j()}),(r,l)=>(u(),M(e(se),{open:r.open,"onUpdate:open":l[2]||(l[2]=p=>v("update:open",p))},{default:n(()=>[s(e(oe),{class:"flex max-h-[90vh] max-w-3xl flex-col overflow-hidden"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ae),{class:"text-xl font-semibold"},{default:n(()=>l[3]||(l[3]=[k("Update Poll",-1)])),_:1,__:[3]})]),_:1}),d.value.length>0?(u(),M(Z,{key:0,errors:d.value,title:"Validation Errors",class:"mx-1"},null,8,["errors"])):o.value?(u(),M(Z,{key:1,errors:[o.value],title:"Error",class:"mx-1"},null,8,["errors"])):T("",!0),t("div",wt,[t("div",bt,[s(e(H),{for:"question",class:"text-sm font-medium"},{default:n(()=>l[4]||(l[4]=[k(" Poll Question * ",-1)])),_:1,__:[4]}),fe(t("textarea",{id:"question","onUpdate:modelValue":l[0]||(l[0]=p=>x.value=p),placeholder:"What would you like to ask?",class:L(["flex min-h-[80px] w-full resize-none rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:border-primary focus:ring-2 focus:ring-primary/20 focus:outline-none disabled:cursor-not-allowed disabled:opacity-50",{"border-red-500 focus:border-red-500 focus:ring-red-500/20":h.value.question}])},null,2),[[ve,x.value]]),h.value.question?(u(),w("p",kt,m(h.value.question),1)):T("",!0)]),t("div",$t,[s(e(H),{class:"text-sm font-medium"},{default:n(()=>l[5]||(l[5]=[k("Poll Options *",-1)])),_:1,__:[5]}),t("div",Ct,[(u(!0),w(G,null,te(i.value,(p,U)=>(u(),w("div",{key:p.id,class:"group flex items-center gap-3"},[t("div",Pt,[s(e(he),{class:"h-4 w-4"})]),t("div",Dt,[s(e(ee),{modelValue:p.text,"onUpdate:modelValue":C=>p.text=C,placeholder:`Option ${U+1}`,class:"cursor-pointer"},null,8,["modelValue","onUpdate:modelValue","placeholder"])]),i.value.length>2?(u(),M(e(P),{key:0,type:"button",variant:"ghost",size:"sm",onClick:C=>z(p.id),class:"h-8 w-8 cursor-pointer p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Remove option"},{default:n(()=>[s(e(ce),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"])):(u(),w("div",St))]))),128))]),s(e(P),{type:"button",variant:"outline",size:"sm",onClick:A,class:"cursor-pointer gap-2",disabled:i.value.length>=10},{default:n(()=>[s(e(Q),{class:"h-4 w-4"}),l[6]||(l[6]=k(" Add Option ",-1))]),_:1,__:[6]},8,["disabled"]),h.value.options?(u(),w("p",Mt,m(h.value.options),1)):T("",!0)]),t("div",Tt,[s(e(H),{for:"expiresAt",class:"text-sm font-medium"},{default:n(()=>l[7]||(l[7]=[k(" Expiry Date (Optional) ",-1)])),_:1,__:[7]}),t("div",Ut,[s(e(ee),{id:"expiresAt",modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=p=>b.value=p),type:"datetime-local",class:L(["cursor-pointer",{"border-red-500 focus:border-red-500 focus:ring-red-500/20":h.value.expiresAt}])},null,8,["modelValue","class"])]),h.value.expiresAt?(u(),w("p",Ot,m(h.value.expiresAt),1)):T("",!0),l[8]||(l[8]=t("p",{class:"text-xs text-muted-foreground"}," Leave empty for polls that never expire ",-1))])]),t("div",Vt,[s(e(P),{type:"button",variant:"outline",onClick:E,class:"cursor-pointer"},{default:n(()=>l[9]||(l[9]=[k(" Cancel ",-1)])),_:1,__:[9]}),s(e(P),{type:"button",onClick:Y,disabled:!O.value||a.value,class:L(["cursor-pointer gap-2",{"cursor-not-allowed":!O.value||a.value}])},{default:n(()=>[a.value?(u(),w("div",jt)):T("",!0),k(" "+m(a.value?"Updating...":"Update Poll"),1)]),_:1},8,["disabled","class"])])]),_:1})]),_:1},8,["open"]))}});function Et(){const $=D(null),_=D(""),c=async(a,o)=>{const d=`${window.location.origin}/poll/${a}`;try{await navigator.clipboard.writeText(d),$.value=o,setTimeout(()=>{$.value=null},2e3)}catch(O){console.error("Failed to copy link:",O)}},v=a=>{const o=`/poll/${a}`;try{const d=document.createElement("a");d.href=o,d.target="_blank",d.rel="noopener noreferrer",document.body.appendChild(d),d.click(),document.body.removeChild(d)}catch(d){console.error("Failed to open poll in new tab:",d),typeof window<"u"&&window.open?window.open(o,"_blank","noopener,noreferrer"):window.location.href=o}},g=(a,o=8e3)=>{_.value=a,setTimeout(()=>{_.value=""},o)};return{copiedPollId:$,successMessage:_,copyPollLink:c,openPollInNewTab:v,showSuccessMessage:g,handlePollCreated:()=>{setTimeout(()=>{ne.visit(window.location.pathname+"?success=poll_created",{preserveState:!1,preserveScroll:!0})},100)},handlePollUpdated:()=>{console.log("Triggering data refresh after poll update"),setTimeout(()=>{ne.visit(window.location.pathname+"?success=poll_updated",{preserveState:!1,preserveScroll:!0})},100)},deletePoll:async a=>{try{const o=await fetch(`/api/polls/${a}`,{method:"DELETE",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"same-origin"}),d=await o.json();return o.ok&&d.success?(setTimeout(()=>{ne.visit(window.location.pathname+"?success=poll_deleted",{preserveState:!1,preserveScroll:!0})},100),!0):(console.error("Delete failed:",d.message),!1)}catch(o){return console.error("Network error:",o),!1}},processUrlSuccessMessages:()=>{const o=new URLSearchParams(window.location.search).get("success");if(o==="poll_created"){g("Poll created successfully! You can now share it with others.");const d=window.location.pathname;window.history.replaceState({},"",d)}else if(o==="poll_updated"){g("Poll updated successfully!");const d=window.location.pathname;window.history.replaceState({},"",d)}else if(o==="poll_deleted"){g("Poll deleted successfully!");const d=window.location.pathname;window.history.replaceState({},"",d)}}}}const At={key:1,class:"mx-6 mt-6 rounded-md border border-green-200 bg-green-50 p-4"},zt={class:"flex"},Lt={class:"ml-3"},Bt={class:"text-sm font-medium text-green-800"},It={class:"flex h-full flex-1 flex-col gap-6 p-6"},Nt={class:"flex items-center justify-between"},Ft={class:"grid gap-4 md:grid-cols-3"},Ht={class:"rounded-lg border bg-card p-6 shadow-sm"},Rt={class:"flex items-center gap-2"},Yt={class:"rounded-full bg-primary/10 p-2"},Jt={class:"text-2xl font-bold"},Gt={class:"rounded-lg border bg-card p-6 shadow-sm"},Qt={class:"flex items-center gap-2"},Wt={class:"rounded-full bg-green-500/10 p-2"},Kt={class:"text-2xl font-bold"},Xt={class:"rounded-lg border bg-card p-6 shadow-sm"},Zt={class:"flex items-center gap-2"},es={class:"rounded-full bg-blue-500/10 p-2"},ts={class:"text-2xl font-bold"},ss={class:"space-y-4"},os={key:0,class:"py-12 text-center"},ls={class:"mx-auto mb-4 flex h-24 w-24 items-center justify-center rounded-full bg-muted"},as={key:1,class:"grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4"},ns={class:"mb-3 flex items-start justify-between gap-2"},rs={class:"min-w-0 flex-1 text-base leading-tight font-semibold text-foreground"},is={class:"mb-3 flex-1 space-y-2 text-sm text-muted-foreground"},ds={class:"flex items-center gap-1"},us={class:"truncate"},cs={class:"flex items-center gap-1"},ps={class:"flex items-center gap-1"},fs={key:0,class:"flex items-center gap-1"},vs={class:"truncate"},ms={class:"mb-3 truncate rounded bg-muted px-2 py-1 font-mono text-xs text-muted-foreground"},gs={key:0,class:"mb-3 flex items-center gap-2 rounded bg-green-50 px-3 py-2 text-sm text-green-700 transition-all duration-300"},xs={class:"flex items-center justify-between gap-1 border-t pt-2"},hs={class:"py-4"},_s={key:0,class:"mt-3 rounded-lg bg-gray-50 p-3"},ys={class:"font-medium text-gray-900"},ws={class:"mt-1 text-sm text-gray-600"},bs={class:"flex justify-end gap-3 border-t pt-4"},Us=q({__name:"Dashboard",setup($){const _=ue(),c=_.props.polls,v=[{title:"Polls Listing",href:qe().url}],{formatDate:g,formatExpiryDate:x}=_e(),{copiedPollId:i,successMessage:b,copyPollLink:h,openPollInNewTab:a,handlePollCreated:o,handlePollUpdated:d,deletePoll:O,processUrlSuccessMessages:V}=Et(),A=D(!1),z=D(!1),E=D(!1),j=D(!1),S=D(null),N=()=>{A.value=!0},Y=C=>{S.value=C,z.value=!0},r=C=>{S.value=C,j.value=!0},l=C=>{S.value=C,E.value=!0},p=async()=>{if(!S.value)return;await O(S.value.id)&&(E.value=!1,S.value=null)},U=()=>{E.value=!1,S.value=null};return be(()=>{V()}),(C,f)=>(u(),w(G,null,[s(e(ke),{title:"Polls Listing"}),s(je,{breadcrumbs:v},{default:n(()=>[e(b)?(u(),M(ye,{key:0,messages:[e(b)],class:"mx-6 mt-6"},null,8,["messages"])):e(_).props.flash?.success?(u(),w("div",At,[t("div",zt,[t("div",Lt,[t("p",Bt,m(e(_).props.flash.success),1)])])])):T("",!0),t("div",It,[t("div",Nt,[f[5]||(f[5]=t("div",null,[t("h1",{class:"text-3xl font-bold text-foreground"},"My Polls"),t("p",{class:"mt-1 text-muted-foreground"}," Manage and track your polls ")],-1)),s(e(P),{size:"lg",class:"cursor-pointer gap-2",onClick:N},{default:n(()=>[s(e(Q),{class:"h-4 w-4"}),f[4]||(f[4]=k(" Create New Poll ",-1))]),_:1,__:[4]})]),t("div",Ft,[t("div",Ht,[t("div",Rt,[t("div",Yt,[s(e(X),{class:"h-4 w-4 text-primary"})]),t("div",null,[f[6]||(f[6]=t("p",{class:"text-sm font-medium text-muted-foreground"}," Total Polls ",-1)),t("p",Jt,m(e(c).length),1)])])]),t("div",Gt,[t("div",Qt,[t("div",Wt,[s(e(re),{class:"h-4 w-4 text-green-600"})]),t("div",null,[f[7]||(f[7]=t("p",{class:"text-sm font-medium text-muted-foreground"}," Total Votes ",-1)),t("p",Kt,m(e(c).reduce((y,F)=>y+F.total_votes,0)),1)])])]),t("div",Xt,[t("div",Zt,[t("div",es,[s(e(ie),{class:"h-4 w-4 text-blue-600"})]),t("div",null,[f[8]||(f[8]=t("p",{class:"text-sm font-medium text-muted-foreground"}," Active Polls ",-1)),t("p",ts,m(e(c).filter(y=>!y.is_expired).length),1)])])])]),t("div",ss,[e(c).length===0?(u(),w("div",os,[t("div",ls,[s(e(X),{class:"h-8 w-8 text-muted-foreground"})]),f[10]||(f[10]=t("h3",{class:"mb-2 text-lg font-semibold"},"No polls yet",-1)),f[11]||(f[11]=t("p",{class:"mb-4 text-muted-foreground"}," Create your first poll to get started ",-1)),s(e(P),{onClick:N,class:"cursor-pointer"},{default:n(()=>[s(e(Q),{class:"mr-2 h-4 w-4"}),f[9]||(f[9]=k(" Create New Poll ",-1))]),_:1,__:[9]})])):(u(),w("div",as,[(u(!0),w(G,null,te(e(c),y=>(u(),w("div",{key:y.id,class:"flex flex-col rounded-lg border bg-card p-4 shadow-sm transition-all duration-200 hover:shadow-md"},[t("div",ns,[t("h3",rs,m(y.question),1),t("span",{class:L(["inline-flex shrink-0 items-center rounded-full px-2 py-1 text-xs font-medium",y.is_expired?"border border-red-200 bg-red-50 text-red-700 dark:border-red-800 dark:bg-red-900/20 dark:text-red-300":"border border-green-200 bg-green-50 text-green-700 dark:border-green-800 dark:bg-green-900/20 dark:text-green-300"])},m(y.is_expired?"Expired":"Active"),3)]),t("div",is,[t("div",ds,[s(e(ge),{class:"h-3 w-3 shrink-0"}),t("span",us,m(e(g)(y.created_at)),1)]),t("div",cs,[s(e(re),{class:"h-3 w-3 shrink-0"}),t("span",null,m(y.total_votes)+" votes",1)]),t("div",ps,[s(e(X),{class:"h-3 w-3 shrink-0"}),t("span",null,m(y.options_count)+" options",1)]),y.is_expired?T("",!0):(u(),w("div",fs,[s(e(ie),{class:"h-3 w-3 shrink-0"}),t("span",vs,m(e(x)(y.expires_at)),1)]))]),t("div",ms," /poll/"+m(y.slug),1),e(i)===y.id?(u(),w("div",gs,f[12]||(f[12]=[t("svg",{class:"h-4 w-4 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M5 13l4 4L19 7"})],-1),t("span",{class:"font-medium"},"Link copied to clipboard!",-1)]))):T("",!0),t("div",xs,[s(e(P),{variant:"ghost",size:"sm",onClick:F=>e(h)(y.slug,y.id),class:"h-8 w-8 flex-shrink-0 cursor-pointer p-0",title:"Copy poll link"},{default:n(()=>[s(e(de),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"]),s(e(P),{variant:"ghost",size:"sm",class:"h-8 w-8 flex-shrink-0 cursor-pointer p-0",title:"Open poll in new tab",onClick:F=>e(a)(y.slug)},{default:n(()=>[s(e(xe),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"]),s(e(P),{variant:"ghost",size:"sm",onClick:F=>r(y),class:"h-8 w-8 flex-shrink-0 cursor-pointer p-0",title:"View poll details"},{default:n(()=>[s(e(Ee),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"]),s(e(P),{variant:"ghost",size:"sm",onClick:F=>Y(y),class:"h-8 w-8 flex-shrink-0 cursor-pointer p-0 text-blue-600 hover:bg-blue-50 hover:text-blue-700",title:"Edit poll"},{default:n(()=>[s(e(Ae),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"]),s(e(P),{variant:"ghost",size:"sm",onClick:F=>l(y),class:"h-8 w-8 flex-shrink-0 cursor-pointer p-0 text-red-600 hover:bg-red-50 hover:text-red-700",title:"Delete poll"},{default:n(()=>[s(e(ze),{class:"h-3.5 w-3.5"})]),_:2},1032,["onClick"])])]))),128))]))])]),s(et,{open:A.value,"onUpdate:open":f[0]||(f[0]=y=>A.value=y),onSuccess:e(o)},null,8,["open","onSuccess"]),s(qt,{open:z.value,"onUpdate:open":f[1]||(f[1]=y=>z.value=y),poll:S.value,onSuccess:e(d)},null,8,["open","poll","onSuccess"]),s(yt,{open:j.value,"onUpdate:open":f[2]||(f[2]=y=>j.value=y),poll:S.value},null,8,["open","poll"]),s(e(se),{open:E.value,"onUpdate:open":f[3]||(f[3]=y=>E.value=y)},{default:n(()=>[s(e(oe),{class:"max-w-md"},{default:n(()=>[s(e(le),null,{default:n(()=>[s(e(ae),{class:"text-xl font-semibold text-red-600"},{default:n(()=>f[13]||(f[13]=[k(" Delete Poll ",-1)])),_:1,__:[13]})]),_:1}),t("div",hs,[f[14]||(f[14]=t("p",{class:"text-gray-700"}," Are you sure you want to delete this poll? ",-1)),S.value?(u(),w("div",_s,[t("p",ys,' "'+m(S.value.question)+'" ',1),t("p",ws,m(S.value.total_votes)+" votes • "+m(S.value.options_count)+" options ",1)])):T("",!0),f[15]||(f[15]=t("p",{class:"mt-3 text-sm text-red-600"}," This action cannot be undone. All votes and poll data will be permanently deleted. ",-1))]),t("div",bs,[s(e(P),{type:"button",variant:"outline",onClick:U,class:"cursor-pointer"},{default:n(()=>f[16]||(f[16]=[k(" Cancel ",-1)])),_:1,__:[16]}),s(e(P),{type:"button",variant:"destructive",onClick:p,class:"cursor-pointer bg-red-600 hover:bg-red-700"},{default:n(()=>f[17]||(f[17]=[k(" Delete Poll ",-1)])),_:1,__:[17]})])]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{Us as default};
