import{d as T,k as n,i as D,c as r,o,a as u,b as l,u as c,h as j,e as C,f as v,t as i,w as x,q as g,n as q,E as z,g as S,F as $,x as A,s as P,a7 as Y}from"./app-NQkzR2QC.js";import{a as F,_ as E}from"./AlertError.vue_vue_type_script_setup_true_lang-CSRhsPvf.js";import{_ as M}from"./index-wNC58uex.js";import{_ as N,a as O}from"./Label.vue_vue_type_script_setup_true_lang-BFdAB7sT.js";const U={class:"min-h-screen bg-gray-50 px-4 py-12 sm:px-6 lg:px-8"},H={class:"mx-auto max-w-md"},I={key:0,class:"text-center"},J={class:"mb-6 text-gray-600"},R={key:1,class:"rounded-lg bg-white p-6 shadow"},G={class:"mb-6"},K={class:"mb-2 text-2xl font-bold text-gray-900"},Q={key:0,class:"mb-6 rounded-md bg-red-50 p-4"},W={class:"mb-6"},X={class:"space-y-3"},Z=["id","value"],ee=["for"],se={class:"mb-6"},te={key:0,class:"mr-2 h-4 w-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},le={class:"mt-6 border-t pt-4 text-center text-sm text-gray-500"},ne=T({__name:"Vote",props:{poll:{}},setup(B){const h=B,f=n(null),d=n(""),a=n(!1),p=n(""),m=n([]),_=n(""),y=n(!1),w=D(()=>f.value!==null&&d.value.trim()!==""&&/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(d.value.trim())),L=async()=>{if(!w.value||a.value||h.poll.is_expired)return;a.value=!0,p.value="",m.value=[];const s={poll_option_id:f.value,email:d.value.trim()};try{const e=await fetch(`/api/polls/${h.poll.slug}/vote`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},credentials:"same-origin",body:JSON.stringify(s)}),t=await e.json();if(e.ok&&t.success)_.value=t.message||"Your vote has been submitted successfully!",y.value=!0,f.value=null,d.value="";else if(a.value=!1,e.status===422&&t.errors){const b=[];for(const V in t.errors)Array.isArray(t.errors[V])&&b.push(...t.errors[V]);m.value=b,p.value=""}else p.value=t.message||"Failed to submit vote. Please try again.",m.value=[]}catch(e){a.value=!1,p.value="Network error. Please check your connection and try again.",m.value=[],console.error("Network error:",e)}},k=s=>{if(!s)return null;const e=new Date(s);return e<new Date?"This poll has expired":`This poll expires on ${e.toLocaleDateString()}`};return(s,e)=>(o(),r($,null,[u(c(j),{title:`Vote: ${s.poll.question}`},null,8,["title"]),l("div",U,[l("div",H,[y.value?(o(),r("div",I,[e[6]||(e[6]=C('<div class="mb-6"><div class="mx-auto flex h-12 w-12 items-center justify-center rounded-full bg-green-100"><svg class="h-6 w-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg></div></div><h1 class="mb-4 text-2xl font-bold text-gray-900"> Vote Submitted! </h1>',2)),u(F,{messages:[_.value],title:"Thank you!",class:"mb-6"},null,8,["messages"]),l("p",J,[e[3]||(e[3]=v(' Your vote for "',-1)),l("strong",null,i(s.poll.question),1),e[4]||(e[4]=v('" has been recorded. ',-1))]),u(c(M),{onClick:e[0]||(e[0]=t=>{y.value=!1,a.value=!1}),variant:"outline",class:"cursor-pointer"},{default:x(()=>e[5]||(e[5]=[v(" Vote Again ",-1)])),_:1,__:[5]})])):(o(),r("div",R,[l("div",G,[l("h1",K,i(s.poll.question),1),k(s.poll.expires_at)?(o(),r("p",{key:0,class:q([s.poll.is_expired?"text-red-600":"text-gray-500","text-sm"])},i(k(s.poll.expires_at)),3)):g("",!0)]),s.poll.is_expired?(o(),r("div",Q,e[7]||(e[7]=[C('<div class="flex"><div class="flex-shrink-0"><svg class="h-5 w-5 text-red-400" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path></svg></div><div class="ml-3"><h3 class="text-sm font-medium text-red-800"> Poll Expired </h3><div class="mt-2 text-sm text-red-700"><p>This poll is no longer accepting votes.</p></div></div></div>',1)]))):g("",!0),s.poll.is_expired?g("",!0):(o(),r("form",{key:1,onSubmit:z(L,["prevent"])},[m.value.length>0?(o(),S(E,{key:0,errors:m.value,title:"Validation Errors",class:"mb-4"},null,8,["errors"])):p.value?(o(),S(E,{key:1,errors:[p.value],title:"Error",class:"mb-4"},null,8,["errors"])):g("",!0),l("div",W,[u(c(N),{class:"mb-3 block text-base font-medium text-gray-900"},{default:x(()=>e[8]||(e[8]=[v(" Choose your option: ",-1)])),_:1,__:[8]}),l("div",X,[(o(!0),r($,null,A(s.poll.options,t=>(o(),r("div",{key:t.id,class:"flex items-center"},[P(l("input",{id:`option-${t.id}`,"onUpdate:modelValue":e[1]||(e[1]=b=>f.value=b),value:t.id,name:"poll-option",type:"radio",class:"h-4 w-4 cursor-pointer border-gray-300 text-blue-600 focus:ring-blue-500"},null,8,Z),[[Y,f.value]]),l("label",{for:`option-${t.id}`,class:"ml-3 flex-1 cursor-pointer py-2 text-sm font-medium text-gray-700"},i(t.option_text),9,ee)]))),128))])]),l("div",se,[u(c(N),{for:"email",class:"mb-2 block text-base font-medium text-gray-900"},{default:x(()=>e[9]||(e[9]=[v(" Your email address: ",-1)])),_:1,__:[9]}),u(c(O),{id:"email",modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=t=>d.value=t),type:"email",placeholder:"Enter your email",class:"w-full cursor-pointer",disabled:a.value,required:""},null,8,["modelValue","disabled"]),e[10]||(e[10]=l("p",{class:"mt-1 text-xs text-gray-500"}," Used to prevent duplicate voting. Your email won't be shared. ",-1))]),u(c(M),{type:"submit",disabled:!w.value||a.value,class:"w-full cursor-pointer bg-blue-600 hover:bg-blue-700 disabled:cursor-not-allowed disabled:opacity-50"},{default:x(()=>[a.value?(o(),r("svg",te,e[11]||(e[11]=[l("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),l("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):g("",!0),v(" "+i(a.value?"Submitting Vote...":"Submit Vote"),1)]),_:1},8,["disabled"])],32)),l("div",le,i(s.poll.total_votes)+" "+i(s.poll.total_votes===1?"vote":"votes")+" â€¢ "+i(s.poll.options.length)+" options ",1)]))])])],64))}});export{ne as default};
