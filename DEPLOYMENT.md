# ðŸš€ AWS Lightsail Deployment Guide

## Prerequisites

- Node.js 20.19+ or 22.12+ (for building assets)
- Your AWS Lightsail instance with Apache/PHP setup

## Step 1: Configure Production Environment

### Update .env file with production settings:

```env
APP_NAME="Mini Applications Platform"
APP_ENV=production
APP_DEBUG=false
APP_URL=https://yourdomain.com  # Replace with your actual domain

# Database Configuration (SQLite - Simple!)
DB_CONNECTION=sqlite
# No other DB settings needed for SQLite!

# Security
APP_KEY=base64:your_app_key_here  # Keep your existing key or generate new one

# Logging
LOG_CHANNEL=stack
LOG_LEVEL=error

# Cache & Session
CACHE_DRIVER=file
SESSION_DRIVER=database  # Uses SQLite database for sessions
SESSION_LIFETIME=120

# Queue (also uses SQLite)
QUEUE_CONNECTION=database

# Other settings...
```

## Step 2: Build Production Assets Locally

**Important:** Make sure you have Node.js 20.19+ installed locally.

```bash
# Install dependencies (if not already installed)
npm install

# Build production assets
npm run build

# This creates optimized files in public/build/
```

## Step 3: Files to Deploy

Upload these files/folders to your Lightsail instance:

### Required Files:

```
â”œâ”€â”€ app/                    # Laravel application logic
â”œâ”€â”€ bootstrap/             # Laravel bootstrap files
â”œâ”€â”€ config/                # Configuration files
â”œâ”€â”€ database/              # Migrations, seeders, factories
â”œâ”€â”€ public/                # Web root (IMPORTANT: includes build assets)
â”‚   â”œâ”€â”€ build/            # Production assets (generated by npm run build)
â”‚   â””â”€â”€ index.php         # Laravel entry point
â”œâ”€â”€ resources/             # Views, raw assets (but not js/css - they're built)
â”œâ”€â”€ routes/                # Route definitions
â”œâ”€â”€ storage/               # Logs, cache, uploads
â”œâ”€â”€ vendor/                # Composer dependencies
â”œâ”€â”€ .env                   # Production environment file
â”œâ”€â”€ artisan                # Laravel CLI
â”œâ”€â”€ composer.json          # PHP dependencies
â””â”€â”€ composer.lock          # Dependency lock file
```

### Files NOT to deploy:

```
node_modules/              # Don't upload - too large
.git/                      # Version control
tests/                     # Test files
resources/js/              # Raw JS files (built versions are in public/build/)
resources/css/             # Raw CSS files (built versions are in public/build/)
.env.example              # Example file
package.json              # Not needed on server
package-lock.json         # Not needed on server
vite.config.ts            # Build tool config
```

## SQLite Database Benefits

âœ… **Why SQLite is perfect for your deployment:**

- **No database server setup required** - SQLite is file-based
- **No database credentials to manage** - Just a file
- **Automatic backups** - Just copy the database.sqlite file
- **Perfect for small to medium apps** - Your poll creator is ideal for SQLite
- **Already configured** - Your app is already using SQLite locally

## Step 4: Apache Virtual Host Configuration

**YES, you need to point your domain to `public/index.php`**

### Create/Edit Apache Virtual Host:

```apache
<VirtualHost *:80>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    DocumentRoot /var/www/html/poll-creator/public

    <Directory /var/www/html/poll-creator/public>
        AllowOverride All
        Require all granted

        # Enable Laravel's .htaccess rewrite rules
        Options -MultiViews -Indexes
        RewriteEngine On

        # Handle Angular and Vue.js routes
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L]
    </Directory>

    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"

    # Logs
    ErrorLog ${APACHE_LOG_DIR}/poll-creator_error.log
    CustomLog ${APACHE_LOG_DIR}/poll-creator_access.log combined
</VirtualHost>

# SSL Configuration (recommended)
<VirtualHost *:443>
    ServerName yourdomain.com
    ServerAlias www.yourdomain.com
    DocumentRoot /var/www/html/poll-creator/public

    # SSL Configuration
    SSLEngine on
    SSLCertificateFile /path/to/your/certificate.crt
    SSLCertificateKeyFile /path/to/your/private.key

    # Same directory configuration as above
    <Directory /var/www/html/poll-creator/public>
        AllowOverride All
        Require all granted
        Options -MultiViews -Indexes
        RewriteEngine On
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteRule ^ index.php [L]
    </Directory>
</VirtualHost>
```

## Step 5: Server Setup Commands

After uploading files to your Lightsail instance:

```bash
# Navigate to your app directory
cd /var/www/html/poll-creator

# Set proper permissions for Laravel
sudo chown -R www-data:www-data storage bootstrap/cache
sudo chmod -R 775 storage bootstrap/cache

# Set proper permissions for SQLite database
sudo chown www-data:www-data database/database.sqlite
sudo chmod 664 database/database.sqlite
sudo chown www-data:www-data database/
sudo chmod 775 database/

# Install PHP dependencies (if not already done)
composer install --optimize-autoloader --no-dev

# Generate application key (if needed)
php artisan key:generate

# Run database migrations
php artisan migrate

# Seed the database (optional)
php artisan db:seed --class=CoWorkingSpaceSeeder

# Clear and cache configuration
php artisan config:cache
php artisan route:cache
php artisan view:cache

# Generate Wayfinder routes
php artisan wayfinder:generate

# Restart Apache
sudo systemctl restart apache2
```

## Step 6: SSL Certificate (Recommended)

```bash
# Install Certbot (if not already installed)
sudo apt update
sudo apt install certbot python3-certbot-apache

# Get SSL certificate
sudo certbot --apache -d yourdomain.com -d www.yourdomain.com
```

## Step 7: Final Verification

1. Visit `https://yourdomain.com`
2. Test registration/login
3. Check app selection page
4. Test Poll Creator functionality

## Troubleshooting

### Common Issues:

1. **500 Error**: Check Apache error logs

    ```bash
    sudo tail -f /var/log/apache2/poll-creator_error.log
    ```

2. **Assets not loading**: Ensure `public/build/` folder was uploaded

3. **SQLite database**: Ensure database/database.sqlite exists and is writable by www-data

4. **Permissions**: Ensure storage, bootstrap/cache, and database/ are writable

### Important Notes:

- **Domain Configuration**: The APP_URL in .env MUST match your actual domain
- **Build Assets**: The `public/build/` folder contains your compiled JS/CSS
- **No Node.js needed on server**: Since you're building locally
- **Database**: Make sure your production database exists and is accessible
- **Security**: Use strong passwords and enable SSL

## Deployment Checklist

- [ ] Updated .env with production settings
- [ ] Built assets locally with `npm run build`
- [ ] Uploaded all required files (excluding node_modules, .git, etc.)
- [ ] Configured Apache virtual host pointing to `public/index.php`
- [ ] Set proper file permissions
- [ ] Ran composer install --no-dev
- [ ] Ran database migrations
- [ ] Cached Laravel configurations
- [ ] Generated Wayfinder routes
- [ ] Configured SSL certificate
- [ ] Tested application functionality

Your Mini Applications Platform should now be live! ðŸŽ‰
